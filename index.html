<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>مشغل الفيديو الاحترافي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .mobile-padding {
                padding: 1rem !important;
            }
            
            .mobile-text {
                font-size: 0.875rem !important;
            }
            
            .mobile-button {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.75rem !important;
                min-width: auto !important;
            }
            
            .mobile-video {
                height: 250px !important;
            }

            .mobile-controls {
                gap: 0.25rem !important;
            }

            .mobile-grid {
                grid-template-columns: 1fr !important;
            }
        }

        /* Touch-friendly controls */
        @media (hover: none) and (pointer: coarse) {
            .control-btn {
                min-height: 44px;
                min-width: 44px;
                touch-action: manipulation;
            }
        }
        
        .video-container {
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .control-btn {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .playlist-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .playlist-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(-5px);
        }
        
        .playlist-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #4facfe 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .video-player {
            width: 100%;
            height: 400px;
            border-radius: 15px;
            background: #000;
        }

        @media (max-width: 768px) {
            .video-player {
                height: 250px;
            }
        }

        .status-message {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
            font-weight: 600;
        }

        .status-success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-info {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
        }

        .loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff40;
            border-top: 2px solid #fff;
            border-radius: 50%;
            margin-left: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8">
        <!-- Header -->
        <div class="text-center mb-4 sm:mb-8 mobile-padding">
            <h1 class="text-2xl sm:text-4xl font-bold text-white mb-2 sm:mb-4">🎬 مشغل الفيديو الاحترافي</h1>
            <p class="text-white/80 text-sm sm:text-lg mobile-text">شغل فيديوهات Teams وجميع المنصات الأخرى بسهولة</p>
        </div>

        <div class="grid mobile-grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-8">
            <!-- Video Player Section -->
            <div class="lg:col-span-2">
                <div class="video-container p-3 sm:p-6 mobile-padding">
                    <!-- URL Input -->
                    <div class="mb-4 sm:mb-6">
                        <label class="block text-white font-semibold mb-2 sm:mb-3 mobile-text">🔗 رابط الفيديو:</label>
                        <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                            <input 
                                type="url" 
                                id="videoUrl" 
                                placeholder="الصق رابط الفيديو هنا..."
                                class="flex-1 px-3 sm:px-4 py-2 sm:py-3 rounded-xl glass-effect text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 mobile-text"
                            >
                            <button 
                                onclick="loadVideo()" 
                                class="control-btn px-4 sm:px-6 py-2 sm:py-3 rounded-xl text-white font-semibold mobile-button"
                            >
                                تشغيل
                            </button>
                        </div>
                    </div>

                    <!-- Quick Links -->
                    <div class="mb-4 flex flex-wrap gap-2">
                        <button onclick="loadDemoVideo('youtube')" class="control-btn px-3 py-1 rounded-lg text-white text-xs">
                            مثال YouTube
                        </button>
                        <button onclick="loadDemoVideo('mp4')" class="control-btn px-3 py-1 rounded-lg text-white text-xs">
                            مثال MP4
                        </button>
                        <button onclick="loadDemoVideo('vimeo')" class="control-btn px-3 py-1 rounded-lg text-white text-xs">
                            مثال Vimeo
                        </button>
                    </div>

                    <!-- Status Messages -->
                    <div id="statusMessage" style="display: none;"></div>

                    <!-- Video Player -->
                    <div class="mb-4 sm:mb-6">
                        <div id="videoContainer" class="bg-black rounded-xl overflow-hidden">
                            <video 
                                id="videoPlayer" 
                                class="video-player" 
                                controls 
                                preload="metadata"
                                style="display: none;"
                                crossorigin="anonymous"
                            >
                                متصفحك لا يدعم تشغيل الفيديو
                            </video>
                            
                            <iframe 
                                id="embedPlayer" 
                                class="video-player" 
                                frameborder="0" 
                                allowfullscreen
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                style="display: none;"
                            ></iframe>

                            <div id="loadingMessage" class="video-player loading" style="display: none;">
                                جاري تحميل الفيديو...
                            </div>

                            <div id="placeholderMessage" class="video-player flex items-center justify-center text-white/60">
                                <div class="text-center">
                                    <div class="text-4xl mb-4">📹</div>
                                    <p class="mobile-text">الصق رابط الفيديو واضغط تشغيل</p>
                                    <p class="mobile-text text-sm mt-2 opacity-70">أو جرب الأمثلة أعلاه</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Video Info -->
                    <div id="videoInfo" style="display: none;" class="mb-4 p-3 glass-effect rounded-xl text-white">
                        <h4 class="font-semibold mb-2">معلومات الفيديو:</h4>
                        <div id="videoDetails"></div>
                    </div>

                    <!-- Video Controls -->
                    <div class="flex flex-wrap mobile-controls gap-2 sm:gap-3 justify-center">
                        <button onclick="playPause()" class="control-btn px-3 sm:px-4 py-2 rounded-lg text-white mobile-button">
                            ⏯️ تشغيل/إيقاف
                        </button>
                        <button onclick="changeVolume(-0.1)" class="control-btn px-3 sm:px-4 py-2 rounded-lg text-white mobile-button">
                            🔉 خفض الصوت
                        </button>
                        <button onclick="changeVolume(0.1)" class="control-btn px-3 sm:px-4 py-2 rounded-lg text-white mobile-button">
                            🔊 رفع الصوت
                        </button>
                        <button onclick="toggleFullscreen()" class="control-btn px-3 sm:px-4 py-2 rounded-lg text-white mobile-button">
                            🔳 ملء الشاشة
                        </button>
                        <button onclick="downloadVideo()" class="control-btn px-3 sm:px-4 py-2 rounded-lg text-white mobile-button">
                            📥 تحميل
                        </button>
                        <button onclick="copyVideoUrl()" class="control-btn px-3 sm:px-4 py-2 rounded-lg text-white mobile-button">
                            📋 نسخ الرابط
                        </button>
                    </div>
                </div>
            </div>

            <!-- Playlist Section -->
            <div class="lg:col-span-1">
                <div class="glass-effect rounded-xl p-3 sm:p-6 mobile-padding">
                    <h3 class="text-white font-bold text-lg sm:text-xl mb-3 sm:mb-4 mobile-text">📋 قائمة التشغيل</h3>
                    
                    <!-- Add to Playlist -->
                    <div class="mb-4">
                        <input 
                            type="text" 
                            id="playlistTitle" 
                            placeholder="عنوان الفيديو..."
                            class="w-full px-3 py-2 rounded-lg glass-effect text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 mb-2 mobile-text"
                        >
                        <button 
                            onclick="addToPlaylist()" 
                            class="w-full control-btn py-2 rounded-lg text-white font-semibold mobile-button"
                        >
                            ➕ إضافة للقائمة
                        </button>
                    </div>

                    <!-- Playlist Items -->
                    <div id="playlistContainer" class="space-y-2">
                        <div class="text-white/60 text-center py-4 mobile-text">
                            لا توجد فيديوهات في القائمة
                        </div>
                    </div>

                    <!-- Clear Playlist -->
                    <button 
                        onclick="clearPlaylist()" 
                        class="w-full mt-4 control-btn py-2 rounded-lg text-white font-semibold mobile-button"
                    >
                        🗑️ مسح القائمة
                    </button>
                </div>

                <!-- Supported Formats -->
                <div class="glass-effect rounded-xl p-3 sm:p-6 mt-4 mobile-padding">
                    <h3 class="text-white font-bold text-lg mb-3 mobile-text">✅ المنصات المدعومة</h3>
                    <ul class="text-white/80 space-y-1 mobile-text">
                        <li>• YouTube (تضمين + تحميل) ✅</li>
                        <li>• Vimeo (تضمين + تحميل) ✅</li>
                        <li>• ملفات MP4 مباشرة ✅</li>
                        <li>• روابط الفيديو المباشرة ✅</li>
                        <li>• Microsoft Teams (محدود) ⚠️</li>
                        <li>• متوافق مع الجوال والكمبيوتر ✅</li>
                    </ul>
                    
                    <div class="mt-4 p-3 bg-white/10 rounded-lg">
                        <h4 class="text-white font-semibold mb-2 mobile-text">💡 نصائح</h4>
                        <ul class="text-white/70 text-xs space-y-1">
                            <li>• استخدم روابط مباشرة للفيديو</li>
                            <li>• تأكد من صحة الرابط</li>
                            <li>• جرب الأمثلة للاختبار</li>
                            <li>• استخدم خيار التحميل للحفظ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Use in-memory storage instead of localStorage
        let currentPlaylist = [];
        let currentVideoIndex = -1;

        // Demo videos for testing
        const demoVideos = {
            youtube: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
            mp4: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
            vimeo: 'https://vimeo.com/76979871'
        };

        function loadDemoVideo(type) {
            if (demoVideos[type]) {
                document.getElementById('videoUrl').value = demoVideos[type];
                loadVideo();
            }
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function showLoading(show = true) {
            const loading = document.getElementById('loadingMessage');
            const placeholder = document.getElementById('placeholderMessage');
            
            if (show) {
                loading.style.display = 'flex';
                placeholder.style.display = 'none';
            } else {
                loading.style.display = 'none';
            }
        }

        function hideAllPlayers() {
            document.getElementById('videoPlayer').style.display = 'none';
            document.getElementById('embedPlayer').style.display = 'none';
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('placeholderMessage').style.display = 'none';
        }

        function extractVideoId(url) {
            // YouTube - improved regex
            const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const youtubeMatch = url.match(youtubeRegex);
            if (youtubeMatch) {
                return { type: 'youtube', id: youtubeMatch[1], url: url };
            }

            // Vimeo - improved regex
            const vimeoRegex = /(?:vimeo\.com\/)([0-9]+)/;
            const vimeoMatch = url.match(vimeoRegex);
            if (vimeoMatch) {
                return { type: 'vimeo', id: vimeoMatch[1], url: url };
            }

            // Teams detection
            if (url.includes('teams.microsoft.com') || url.includes('sharepoint.com')) {
                return { type: 'teams', id: url, url: url };
            }

            // Direct video files - improved detection
            if (url.match(/\.(mp4|webm|ogg|mov|avi|m4v|3gp|flv)(\?.*)?$/i)) {
                return { type: 'direct', id: url, url: url };
            }

            // Check if it's an embed URL
            if (url.includes('/embed/') || url.includes('embed')) {
                return { type: 'embed', id: url, url: url };
            }

            return { type: 'unknown', id: url, url: url };
        }

        function updateVideoInfo(videoInfo, success = true) {
            const infoDiv = document.getElementById('videoInfo');
            const detailsDiv = document.getElementById('videoDetails');
            
            if (success) {
                detailsDiv.innerHTML = `
                    <p><strong>النوع:</strong> ${getTypeLabel(videoInfo.type)}</p>
                    <p><strong>الرابط:</strong> <span class="text-sm opacity-80">${videoInfo.url.substring(0, 50)}${videoInfo.url.length > 50 ? '...' : ''}</span></p>
                `;
                infoDiv.style.display = 'block';
            } else {
                infoDiv.style.display = 'none';
            }
        }

        function getTypeLabel(type) {
            const labels = {
                youtube: 'YouTube',
                vimeo: 'Vimeo', 
                direct: 'ملف فيديو مباشر',
                teams: 'Microsoft Teams',
                embed: 'فيديو مضمن',
                unknown: 'نوع غير محدد'
            };
            return labels[type] || type;
        }

        async function loadVideo() {
            const urlInput = document.getElementById('videoUrl');
            const url = urlInput.value.trim();
            
            if (!url) {
                showStatus(`تم تشغيل: ${item.title}`, 'success');
            }
        }

        function removeFromPlaylist(id) {
            currentPlaylist = currentPlaylist.filter(item => item.id !== id);
            if (currentVideoIndex >= currentPlaylist.length) {
                currentVideoIndex = -1;
            }
            updatePlaylistDisplay();
            showStatus('تم حذف الفيديو من القائمة', 'info');
        }

        function clearPlaylist() {
            if (currentPlaylist.length === 0) {
                showStatus('القائمة فارغة بالفعل', 'info');
                return;
            }
            
            if (confirm('هل أنت متأكد من مسح جميع الفيديوهات؟')) {
                currentPlaylist = [];
                currentVideoIndex = -1;
                updatePlaylistDisplay();
                showStatus('تم مسح القائمة بالكامل', 'info');
            }
        }

        async function downloadVideo() {
            const urlInput = document.getElementById('videoUrl');
            const url = urlInput.value.trim();
            
            if (!url) {
                showStatus('يرجى إدخال رابط الفيديو أولاً', 'error');
                return;
            }

            const videoInfo = extractVideoId(url);
            showStatus('جاري تحضير التحميل...', 'info');
            
            try {
                switch (videoInfo.type) {
                    case 'direct':
                        try {
                            // Create download link for direct videos
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = url.split('/').pop().split('?')[0] || `video_${Date.now()}.mp4`;
                            a.target = '_blank';
                            a.rel = 'noopener noreferrer';
                            
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            
                            showStatus('تم بدء التحميل! 📥', 'success');
                        } catch (error) {
                            showStatus('خطأ في التحميل المباشر', 'error');
                        }
                        break;

                    case 'youtube':
                        // Open YouTube downloader services
                        const youtubeDownloaders = [
                            `https://savefrom.net/#url=${encodeURIComponent(url)}`,
                            `https://www.y2mate.com/youtube/${videoInfo.id}`,
                            `https://yt1s.com/youtube-to-mp4?q=${encodeURIComponent(url)}`
                        ];
                        
                        window.open(youtubeDownloaders[0], '_blank');
                        showStatus('تم فتح موقع تحميل YouTube', 'success');
                        
                        setTimeout(() => {
                            if (confirm('هل تريد المزيد من خيارات التحميل؟')) {
                                youtubeDownloaders.slice(1).forEach(link => {
                                    setTimeout(() => window.open(link, '_blank'), 500);
                                });
                            }
                        }, 2000);
                        break;

                    case 'vimeo':
                        const vimeoDownloadUrl = `https://vimeodownloader.com/vimeo-video-downloader?url=${encodeURIComponent(url)}`;
                        window.open(vimeoDownloadUrl, '_blank');
                        showStatus('تم فتح موقع تحميل Vimeo', 'success');
                        break;

                    case 'teams':
                        showStatus('فيديوهات Teams تحتاج صلاحيات خاصة للتحميل', 'info');
                        
                        // Try to extract direct URL if possible
                        if (url.includes('sharepoint.com') && url.includes('.mp4')) {
                            try {
                                const directUrl = url.replace('/embed', '').replace('?web=1', '');
                                const a = document.createElement('a');
                                a.href = directUrl;
                                a.download = `teams_video_${Date.now()}.mp4`;
                                a.target = '_blank';
                                
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                
                                showStatus('تم محاولة تحميل فيديو Teams', 'info');
                            } catch (error) {
                                showStatus('لا يمكن تحميل هذا الفيديو من Teams', 'error');
                            }
                        }
                        break;

                    default:
                        // For unknown types, try multiple approaches
                        try {
                            // First try direct download
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `video_${Date.now()}`;
                            a.target = '_blank';
                            a.rel = 'noopener noreferrer';
                            
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            
                            showStatus('تم فتح رابط التحميل', 'success');
                        } catch (error) {
                            // Fallback to generic downloader
                            const genericDownloader = `https://savefrom.net/#url=${encodeURIComponent(url)}`;
                            window.open(genericDownloader, '_blank');
                            showStatus('تم فتح موقع تحميل عام', 'info');
                        }
                        break;
                }
                
            } catch (error) {
                console.error('Download error:', error);
                showStatus('حدث خطأ أثناء التحميل', 'error');
                
                // Final fallback: copy URL to clipboard
                try {
                    navigator.clipboard.writeText(url).then(() => {
                        showStatus('تم نسخ الرابط للحافظة', 'info');
                    });
                } catch (clipboardError) {
                    console.error('Clipboard error:', clipboardError);
                    showStatus('لا يمكن نسخ الرابط تلقائياً', 'error');
                }
            }
        }

        function copyVideoUrl() {
            const urlInput = document.getElementById('videoUrl');
            const url = urlInput.value.trim();
            
            if (!url) {
                showStatus('لا يوجد رابط للنسخ', 'error');
                return;
            }

            try {
                // Modern clipboard API
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(url).then(() => {
                        showStatus('تم نسخ الرابط بنجاح! 📋', 'success');
                    }).catch(() => {
                        fallbackCopy();
                    });
                } else {
                    fallbackCopy();
                }
            } catch (error) {
                fallbackCopy();
            }

            function fallbackCopy() {
                try {
                    // Fallback for older browsers
                    urlInput.select();
                    urlInput.setSelectionRange(0, 99999); // For mobile devices
                    const successful = document.execCommand('copy');
                    
                    if (successful) {
                        showStatus('تم نسخ الرابط بنجاح! 📋', 'success');
                    } else {
                        showStatus('تم تحديد الرابط - اضغط Ctrl+C للنسخ', 'info');
                    }
                } catch (error) {
                    showStatus('تم تحديد الرابط - اضغط Ctrl+C للنسخ', 'info');
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Space bar for play/pause (only if not typing in input)
            if (e.code === 'Space' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                e.preventDefault();
                playPause();
            }
            
            // F for fullscreen
            if (e.key === 'f' || e.key === 'F') {
                if (!['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                    e.preventDefault();
                    toggleFullscreen();
                }
            }
        });

        // Handle Enter key in inputs
        document.getElementById('videoUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                loadVideo();
            }
        });

        document.getElementById('playlistTitle').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addToPlaylist();
            }
        });

        // Auto-load video when URL is pasted
        document.getElementById('videoUrl').addEventListener('paste', function(e) {
            setTimeout(() => {
                const url = e.target.value.trim();
                if (url && confirm('هل تريد تحميل الفيديو تلقائياً؟')) {
                    loadVideo();
                }
            }, 100);
        });

        // Initialize on page load
        window.addEventListener('load', function() {
            updatePlaylistDisplay();
            showStatus('مرحباً بك في مشغل الفيديو الاحترافي! جرب الأمثلة أو الصق رابط فيديو', 'info');
        });

        // Handle video player events
        document.getElementById('videoPlayer').addEventListener('loadstart', function() {
            showStatus('بدء تحميل الفيديو...', 'info');
        });

        document.getElementById('videoPlayer').addEventListener('canplay', function() {
            showStatus('الفيديو جاهز للتشغيل', 'success');
        });

        document.getElementById('videoPlayer').addEventListener('error', function(e) {
            console.error('Video error:', e);
            showStatus('خطأ في تحميل الفيديو - تحقق من الرابط', 'error');
            hideAllPlayers();
            document.getElementById('placeholderMessage').style.display = 'flex';
        });

        // Handle embed player load
        document.getElementById('embedPlayer').addEventListener('load', function() {
            showStatus('تم تحميل الفيديو المضمن بنجاح', 'success');
        });

        // Responsive design enhancements
        function checkMobile() {
            return window.innerWidth <= 768;
        }

        window.addEventListener('resize', function() {
            // Adjust video player height on resize
            const videoPlayer = document.getElementById('videoPlayer');
            const embedPlayer = document.getElementById('embedPlayer');
            
            if (checkMobile()) {
                videoPlayer.style.height = '250px';
                embedPlayer.style.height = '250px';
            } else {
                videoPlayer.style.height = '400px';
                embedPlayer.style.height = '400px';
            }
        });

        // Prevent context menu on video (optional)
        document.getElementById('videoPlayer').addEventListener('contextmenu', function(e) {
            e.preventDefault();
            showStatus('استخدم الأزرار للتحكم بالفيديو', 'info');
        });

    </script>
</body>
</html>('يرجى إدخال رابط الفيديو', 'error');
                return;
            }

            // Show loading
            showLoading(true);
            showStatus('جاري تحميل الفيديو...', 'info');

            const videoInfo = extractVideoId(url);
            const videoPlayer = document.getElementById('videoPlayer');
            const embedPlayer = document.getElementById('embedPlayer');

            hideAllPlayers();

            try {
                let success = false;

                switch (videoInfo.type) {
                    case 'youtube':
                        try {
                            const embedUrl = `https://www.youtube.com/embed/${videoInfo.id}?autoplay=0&enablejsapi=1`;
                            embedPlayer.src = embedUrl;
                            embedPlayer.style.display = 'block';
                            success = true;
                            showStatus('تم تحميل فيديو YouTube بنجاح', 'success');
                        } catch (error) {
                            throw new Error('فشل في تحميل فيديو YouTube');
                        }
                        break;

                    case 'vimeo':
                        try {
                            const embedUrl = `https://player.vimeo.com/video/${videoInfo.id}?autoplay=0`;
                            embedPlayer.src = embedUrl;
                            embedPlayer.style.display = 'block';
                            success = true;
                            showStatus('تم تحميل فيديو Vimeo بنجاح', 'success');
                        } catch (error) {
                            throw new Error('فشل في تحميل فيديو Vimeo');
                        }
                        break;

                    case 'direct':
                        try {
                            videoPlayer.src = url;
                            videoPlayer.style.display = 'block';
                            
                            // Add event listeners for better error handling
                            videoPlayer.onloadstart = () => showStatus('جاري تحميل الفيديو...', 'info');
                            videoPlayer.oncanplay = () => {
                                showStatus('تم تحميل الفيديو بنجاح', 'success');
                                success = true;
                            };
                            videoPlayer.onerror = () => {
                                showStatus('خطأ في تحميل الفيديو - تحقق من الرابط', 'error');
                                hideAllPlayers();
                                document.getElementById('placeholderMessage').style.display = 'flex';
                            };
                            
                            success = true;
                        } catch (error) {
                            throw new Error('فشل في تحميل الفيديو المباشر');
                        }
                        break;

                    case 'teams':
                        try {
                            // Try different methods for Teams videos
                            if (url.includes('embed')) {
                                embedPlayer.src = url;
                                embedPlayer.style.display = 'block';
                                success = true;
                                showStatus('تم تحميل فيديو Teams (مضمن)', 'success');
                            } else {
                                // Try as direct video
                                videoPlayer.src = url;
                                videoPlayer.style.display = 'block';
                                success = true;
                                showStatus('جاري محاولة تحميل فيديو Teams...', 'info');
                            }
                        } catch (error) {
                            throw new Error('فشل في تحميل فيديو Teams');
                        }
                        break;

                    case 'embed':
                        try {
                            embedPlayer.src = url;
                            embedPlayer.style.display = 'block';
                            success = true;
                            showStatus('تم تحميل الفيديو المضمن', 'success');
                        } catch (error) {
                            throw new Error('فشل في تحميل الفيديو المضمن');
                        }
                        break;

                    default:
                        // Try multiple methods for unknown types
                        try {
                            // First try as direct video
                            videoPlayer.src = url;
                            videoPlayer.style.display = 'block';
                            
                            videoPlayer.onerror = () => {
                                // If direct video fails, try as embed
                                videoPlayer.style.display = 'none';
                                try {
                                    embedPlayer.src = url;
                                    embedPlayer.style.display = 'block';
                                    showStatus('تم تحميل الفيديو كمضمن', 'info');
                                } catch (embedError) {
                                    showStatus('نوع الفيديو غير مدعوم', 'error');
                                    hideAllPlayers();
                                    document.getElementById('placeholderMessage').style.display = 'flex';
                                }
                            };
                            
                            success = true;
                            showStatus('جاري محاولة تحميل الفيديو...', 'info');
                        } catch (error) {
                            throw new Error('فشل في تحميل الفيديو');
                        }
                        break;
                }

                // Update video info
                updateVideoInfo(videoInfo, success);

            } catch (error) {
                console.error('Video loading error:', error);
                showStatus(error.message || 'حدث خطأ في تحميل الفيديو', 'error');
                hideAllPlayers();
                document.getElementById('placeholderMessage').style.display = 'flex';
                updateVideoInfo(videoInfo, false);
            } finally {
                showLoading(false);
            }
        }

        function playPause() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer.style.display !== 'none') {
                try {
                    if (videoPlayer.paused) {
                        videoPlayer.play();
                        showStatus('تم تشغيل الفيديو', 'success');
                    } else {
                        videoPlayer.pause();
                        showStatus('تم إيقاف الفيديو', 'info');
                    }
                } catch (error) {
                    showStatus('خطأ في التحكم بالتشغيل', 'error');
                }
            } else {
                showStatus('لا يوجد فيديو للتحكم به', 'error');
            }
        }

        function changeVolume(delta) {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer.style.display !== 'none') {
                try {
                    const newVolume = Math.max(0, Math.min(1, videoPlayer.volume + delta));
                    videoPlayer.volume = newVolume;
                    showStatus(`مستوى الصوت: ${Math.round(newVolume * 100)}%`, 'info');
                } catch (error) {
                    showStatus('خطأ في تغيير مستوى الصوت', 'error');
                }
            } else {
                showStatus('لا يوجد فيديو للتحكم بصوته', 'error');
            }
        }

        function toggleFullscreen() {
            const videoContainer = document.getElementById('videoContainer');
            try {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                    showStatus('تم إلغاء وضع ملء الشاشة', 'info');
                } else {
                    videoContainer.requestFullscreen().then(() => {
                        showStatus('تم تفعيل وضع ملء الشاشة', 'success');
                    }).catch(() => {
                        showStatus('لا يمكن تفعيل وضع ملء الشاشة', 'error');
                    });
                }
            } catch (error) {
                showStatus('وضع ملء الشاشة غير مدعوم', 'error');
            }
        }

        function addToPlaylist() {
            const urlInput = document.getElementById('videoUrl');
            const titleInput = document.getElementById('playlistTitle');
            const url = urlInput.value.trim();
            const title = titleInput.value.trim() || 'فيديو بدون عنوان';

            if (!url) {
                showStatus('يرجى إدخال رابط الفيديو أولاً', 'error');
                return;
            }

            const videoItem = {
                id: Date.now(),
                title: title,
                url: url,
                addedAt: new Date().toLocaleString('ar-SA'),
                type: extractVideoId(url).type
            };

            currentPlaylist.push(videoItem);
            titleInput.value = '';
            updatePlaylistDisplay();
            showStatus('تم إضافة الفيديو للقائمة', 'success');
        }

        function updatePlaylistDisplay() {
            const container = document.getElementById('playlistContainer');
            
            if (currentPlaylist.length === 0) {
                container.innerHTML = '<div class="text-white/60 text-center py-4 mobile-text">لا توجد فيديوهات في القائمة</div>';
                return;
            }

            container.innerHTML = currentPlaylist.map((item, index) => `
                <div class="playlist-item ${index === currentVideoIndex ? 'active' : ''} p-3 rounded-lg" onclick="playFromPlaylist(${index})">
                    <div class="font-semibold mobile-text">${item.title}</div>
                    <div class="text-xs opacity-70 mt-1">${getTypeLabel(item.type)} - ${item.addedAt}</div>
                    <button onclick="removeFromPlaylist(${item.id}); event.stopPropagation();" class="text-red-400 hover:text-red-300 text-xs mt-2">
                        🗑️ حذف
                    </button>
                </div>
            `).join('');
        }

        function playFromPlaylist(index) {
            const item = currentPlaylist[index];
            if (item) {
                document.getElementById('videoUrl').value = item.url;
                currentVideoIndex = index;
                loadVideo();
                updatePlaylistDisplay();
                showStatus
